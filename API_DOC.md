# Documentation API SmartAgriChange Backend

## Vue d'ensemble

L'API SmartAgriChange Backend est une API RESTful construite avec Laravel 11 qui fournit des services pour la gestion agricole intelligente. Cette API permet la gestion des utilisateurs (agriculteurs), des champs, des parcelles et des services d'authentification avec vÃ©rification OTP.

### URL de base

```
http://localhost:8000/api
```

### Format de rÃ©ponse

Toutes les rÃ©ponses de l'API suivent un format standardisÃ© :

**RÃ©ponse de succÃ¨s:**

```json
{
    "status": "success",
    "message": "Message descriptif",
    "data": {
        // DonnÃ©es de la rÃ©ponse
    }
}
```

**RÃ©ponse d'erreur:**

```json
{
    "status": "error",
    "message": "Message d'erreur",
    "errors": {
        // DÃ©tails des erreurs
    }
}
```

### Authentification

L'API utilise JWT (JSON Web Tokens) pour l'authentification. Incluez le token dans l'en-tÃªte Authorization :

```
Authorization: Bearer {votre_jwt_token}
```

---

## Endpoints de l'API

### 1. Gestion des Utilisateurs

#### 1.1 Inscription d'un Agriculteur

**POST** `/api/users/farmers/register`

CrÃ©e un nouveau compte agriculteur dans le systÃ¨me.

**Corps de la requÃªte:**

```json
{
    "lastname": "Dupont",
    "firstname": "Jean",
    "phone_number": "123456789",
    "password": "motdepasse123",
    "password_confirmation": "motdepasse123",
    "calling_code": "+33"
}
```

**ParamÃ¨tres:**
| ParamÃ¨tre | Type | Requis | Description |
|-----------|------|--------|-------------|
| lastname | string | Oui | Nom de famille (max: 255 caractÃ¨res) |
| firstname | string | Oui | PrÃ©nom (max: 255 caractÃ¨res) |
| phone_number | string | Oui | NumÃ©ro de tÃ©lÃ©phone (max: 20 caractÃ¨res) |
| password | string | Oui | Mot de passe (min: 8 caractÃ¨res) |
| password_confirmation | string | Oui | Confirmation du mot de passe |
| calling_code | string | Optionnel | Code d'appel du pays (max: 10 caractÃ¨res) |

**RÃ©ponse de succÃ¨s (201):**

```json
{
    "status": "success",
    "message": "User created successfully",
    "data": {
        "id": 1,
        "lastname": "Dupont",
        "firstname": "Jean",
        "phone_number": "123456789",
        "calling_code": "+33",
        "created_at": "2024-01-15T10:30:00.000000Z",
        "updated_at": "2024-01-15T10:30:00.000000Z"
    }
}
```

**RÃ©ponses d'erreur:**

-   `422 Unprocessable Entity`: Erreurs de validation
-   `500 Internal Server Error`: Erreur serveur

---

#### 1.2 Connexion Utilisateur

**POST** `/api/users/login`

Authentifie un utilisateur et retourne un token JWT.

> **Note**: Cette fonctionnalitÃ© est dÃ©finie dans les routes mais n'est pas encore implÃ©mentÃ©e dans le contrÃ´leur.

**Corps de la requÃªte:**

```json
{
    "phone_number": "123456789",
    "password": "motdepasse123"
}
```

---

#### 1.3 DÃ©connexion Utilisateur

**POST** `/api/users/logout`

RÃ©voque le token JWT de l'utilisateur authentifiÃ©.

> **Note**: Cette fonctionnalitÃ© est dÃ©finie dans les routes mais n'est pas encore implÃ©mentÃ©e dans le contrÃ´leur.

**En-tÃªtes requis:**

```
Authorization: Bearer {jwt_token}
```

---

### 2. Gestion OTP (One-Time Password)

#### 2.1 VÃ©rification OTP

**POST** `/api/users/{user}/verify-otp`

VÃ©rifie le code OTP pour un utilisateur spÃ©cifique.

**ParamÃ¨tres d'URL:**
| ParamÃ¨tre | Type | Description |
|-----------|------|-------------|
| user | integer | ID de l'utilisateur |

**Corps de la requÃªte:**

```json
{
    "otp_code": "123456"
}
```

**ParamÃ¨tres:**
| ParamÃ¨tre | Type | Requis | Description |
|-----------|------|--------|-------------|
| otp_code | string | Oui | Code OTP Ã  6 chiffres |

**RÃ©ponse de succÃ¨s (200):**

```json
{
    "status": "success",
    "message": "OTP verified successfully",
    "data": null
}
```

**RÃ©ponse d'Ã©chec (200):**

```json
{
    "status": "success",
    "message": "OTP verification failed",
    "data": null
}
```

**RÃ©ponses d'erreur:**

-   `422 Unprocessable Entity`: Code OTP invalide ou inexistant
-   `500 Internal Server Error`: Erreur serveur

---

### 3. Gestion des Champs

#### 3.1 Lister les Champs

**GET** `/api/fields`

RÃ©cupÃ¨re la liste de tous les champs.

> **Note**: Cette fonctionnalitÃ© n'est pas encore implÃ©mentÃ©e.

---

#### 3.2 CrÃ©er un Champ

**POST** `/api/fields`

CrÃ©e un nouveau champ pour l'utilisateur authentifiÃ©.

**En-tÃªtes requis:**

```
Authorization: Bearer {jwt_token}
Content-Type: application/json
```

**Corps de la requÃªte:**

```json
{
    "name": "Champ Principal",
    "location": "Bretagne, France"
}
```

**ParamÃ¨tres:**
| ParamÃ¨tre | Type | Requis | Description |
|-----------|------|--------|-------------|
| name | string | Oui | Nom du champ (max: 255 caractÃ¨res) |
| location | string | Oui | Localisation du champ (max: 255 caractÃ¨res) |

**RÃ©ponse de succÃ¨s (201):**

```json
{
    "status": "success",
    "message": "Field created successfully",
    "data": {
        "id": 1,
        "name": "Champ Principal",
        "location": "Bretagne, France",
        "user_id": 1,
        "created_at": "2024-01-15T10:30:00.000000Z",
        "updated_at": "2024-01-15T10:30:00.000000Z"
    }
}
```

**RÃ©ponses d'erreur:**

-   `401 Unauthorized`: Token JWT manquant ou invalide
-   `422 Unprocessable Entity`: Erreurs de validation
-   `500 Internal Server Error`: Erreur serveur

---

#### 3.3 Afficher un Champ

**GET** `/api/fields/{field}`

RÃ©cupÃ¨re les dÃ©tails d'un champ spÃ©cifique.

> **Note**: Cette fonctionnalitÃ© n'est pas encore implÃ©mentÃ©e.

---

#### 3.4 Modifier un Champ

**PUT/PATCH** `/api/fields/{field}`

Modifie un champ existant.

> **Note**: Cette fonctionnalitÃ© n'est pas encore implÃ©mentÃ©e.

---

#### 3.5 Supprimer un Champ

**DELETE** `/api/fields/{field}`

Supprime un champ existant.

> **Note**: Cette fonctionnalitÃ© n'est pas encore implÃ©mentÃ©e.

---

### 4. Gestion des Parcelles

#### 4.1 Lister les Parcelles

**GET** `/api/parcels`

RÃ©cupÃ¨re la liste de toutes les parcelles.

> **Note**: Cette fonctionnalitÃ© n'est pas encore implÃ©mentÃ©e.

---

#### 4.2 CrÃ©er une Parcelle

**POST** `/api/parcels`

CrÃ©e une nouvelle parcelle.

> **Note**: Cette fonctionnalitÃ© n'est pas encore implÃ©mentÃ©e.

---

#### 4.3 Afficher une Parcelle

**GET** `/api/parcels/{parcel}`

RÃ©cupÃ¨re les dÃ©tails d'une parcelle spÃ©cifique.

> **Note**: Cette fonctionnalitÃ© n'est pas encore implÃ©mentÃ©e.

---

#### 4.4 Modifier une Parcelle

**PUT/PATCH** `/api/parcels/{parcel}`

Modifie une parcelle existante.

> **Note**: Cette fonctionnalitÃ© n'est pas encore implÃ©mentÃ©e.

---

#### 4.5 Supprimer une Parcelle

**DELETE** `/api/parcels/{parcel}`

Supprime une parcelle existante.

> **Note**: Cette fonctionnalitÃ© n'est pas encore implÃ©mentÃ©e.

---

## Codes de Statut HTTP

| Code | Description                                  |
| ---- | -------------------------------------------- |
| 200  | OK - RequÃªte rÃ©ussie                         |
| 201  | Created - Ressource crÃ©Ã©e avec succÃ¨s        |
| 400  | Bad Request - RequÃªte malformÃ©e              |
| 401  | Unauthorized - Authentification requise      |
| 403  | Forbidden - AccÃ¨s interdit                   |
| 404  | Not Found - Ressource non trouvÃ©e            |
| 422  | Unprocessable Entity - Erreurs de validation |
| 500  | Internal Server Error - Erreur serveur       |

---

## ModÃ¨les de DonnÃ©es

### Utilisateur (User)

```json
{
    "id": 1,
    "lastname": "string",
    "firstname": "string",
    "phone_number": "string",
    "calling_code": "string",
    "email_verified_at": "timestamp|null",
    "created_at": "timestamp",
    "updated_at": "timestamp"
}
```

**Relations:**

-   `roles`: Relation many-to-many avec les rÃ´les
-   `countryCallingCode`: Relation belongsTo avec les codes d'appel

### Champ (Field)

```json
{
    "id": 1,
    "name": "string",
    "location": "string",
    "user_id": 1,
    "created_at": "timestamp",
    "updated_at": "timestamp"
}
```

**Relations:**

-   `parcels`: Relation hasMany avec les parcelles

### Parcelle (Parcel)

```json
{
    "id": 1,
    "field_id": 1,
    "created_at": "timestamp",
    "updated_at": "timestamp"
}
```

**Relations:**

-   `field`: Relation belongsTo avec le champ

---

## Gestion des Erreurs

### Erreurs de Validation

Les erreurs de validation retournent un objet dÃ©taillÃ© avec les champs en erreur :

```json
{
    "status": "error",
    "message": "The given data was invalid.",
    "errors": {
        "lastname": ["Le champ nom de famille est requis."],
        "phone_number": [
            "Le numÃ©ro de tÃ©lÃ©phone doit contenir au maximum 20 caractÃ¨res."
        ]
    }
}
```

### Erreurs d'Authentification

```json
{
    "status": "error",
    "message": "Unauthenticated",
    "errors": null
}
```

### Erreurs Serveur

```json
{
    "status": "error",
    "message": "Une erreur interne s'est produite",
    "errors": "Message d'erreur dÃ©taillÃ©"
}
```

---

## Notes de DÃ©veloppement

### FonctionnalitÃ©s ImplÃ©mentÃ©es

-   âœ… Inscription des agriculteurs
-   âœ… VÃ©rification OTP
-   âœ… CrÃ©ation de champs
-   âœ… SystÃ¨me de rÃ©ponses standardisÃ©es
-   âœ… Validation des requÃªtes

### FonctionnalitÃ©s en DÃ©veloppement

-   ğŸ”„ Authentification JWT complÃ¨te (login/logout)
-   ğŸ”„ CRUD complet pour les champs
-   ğŸ”„ CRUD complet pour les parcelles
-   ğŸ”„ Gestion des rÃ´les utilisateurs
-   ğŸ”„ Endpoints de listing avec pagination

### AmÃ©liorations SuggÃ©rÃ©es

1. **Authentification**: ImplÃ©menter les mÃ©thodes login/logout dans UserController
2. **Pagination**: Ajouter la pagination pour les listes d'entitÃ©s
3. **Filtrage**: Ajouter des paramÃ¨tres de filtrage et de recherche
4. **Documentation**: Ajouter une documentation Swagger/OpenAPI
5. **Tests**: ImplÃ©menter des tests unitaires et d'intÃ©gration
6. **Middleware**: Ajouter des middlewares de validation et d'authentification
7. **Cache**: ImplÃ©menter un systÃ¨me de cache pour les requÃªtes frÃ©quentes

---

## Exemples d'Utilisation

### Inscription et VÃ©rification OTP

```bash
# 1. Inscription d'un agriculteur
curl -X POST http://localhost:8000/api/users/farmers/register \
  -H "Content-Type: application/json" \
  -d '{
    "lastname": "Martin",
    "firstname": "Pierre",
    "phone_number": "0123456789",
    "password": "motdepasse123",
    "password_confirmation": "motdepasse123",
    "calling_code": "+33"
  }'

# 2. VÃ©rification OTP (remplacer {user_id} par l'ID retournÃ©)
curl -X POST http://localhost:8000/api/users/{user_id}/verify-otp \
  -H "Content-Type: application/json" \
  -d '{
    "otp_code": "123456"
  }'
```

### CrÃ©ation d'un Champ

```bash
curl -X POST http://localhost:8000/api/fields \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {jwt_token}" \
  -d '{
    "name": "Champ Bio Nord",
    "location": "Normandie, France"
  }'
```

---

**Version de l'API**: 1.0  
**DerniÃ¨re mise Ã  jour**: 13 octobre 2025  
**Framework**: Laravel 11  
**Base de donnÃ©es**: ConfigurÃ©e via migrations Laravel
